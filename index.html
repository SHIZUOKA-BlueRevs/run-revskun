<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ãƒãƒ¼ãƒ å…¬å¼ãƒŸãƒ‹ã‚²ãƒ¼ãƒ </title>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background: #87CEEB; font-family: sans-serif; }
        
        /* èƒŒæ™¯ç”»åƒã®è¨­å®š */
        canvas { 
            display: block; width: 100vw; height: 100vh; touch-action: manipulation;
            background-image: url('bg.jpg'); /* èƒŒæ™¯ç”»åƒ */
            background-size: cover;
            background-position: center;
        }

        #scoreDisplay {
            position: absolute; top: 10px; left: 20px;
            font-size: 40px; font-weight: bold; color: #fff; 
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5); /* æ–‡å­—ã‚’è¦‹ã‚„ã™ã */
            z-index: 10;
        }

        /* è­¦å‘Šãƒ»ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ã®å…±é€šè¨­å®š */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); color: white;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center; text-align: center; z-index: 10000;
        }

        /* ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ */
        #start-screen h1 { font-size: 50px; margin-bottom: 20px; color: #fff; }
        #start-screen p { font-size: 30px; animation: blink 1.5s infinite; }

        /* æ¨ªå‘ãè­¦å‘Šï¼ˆiPhoneå¯¾å¿œç”¨ï¼‰ */
        #orientation-msg { display: none; font-size: 24px; font-weight: bold; }
        #orientation-msg span { font-size: 50px; margin-bottom: 20px; }

        @keyframes blink { 0% {opacity: 1;} 50% {opacity: 0.3;} 100% {opacity: 1;} }
    </style>
</head>
<body>
    <div id="orientation-msg" class="overlay">
        <span>ğŸ“±</span>ç”»é¢ã‚’ã€æ¨ªå‘ãã€‘ã«ã™ã‚‹ã¨<br>ã‚²ãƒ¼ãƒ ãŒã¯ã˜ã¾ã‚‹ã‚ˆï¼
    </div>

    <div id="start-screen" class="overlay">
        <h1>SHIZUOKA BlueRevs RUN</h1>
        <p>ç”»é¢ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã‚¹ã‚¿ãƒ¼ãƒˆï¼</p>
    </div>

    <div id="scoreDisplay">Score: 0</div>
    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const startScreen = document.getElementById("start-screen");
        const orientMsg = document.getElementById("orientation-msg");

        // ç”»åƒã®èª­ã¿è¾¼ã¿æº–å‚™
        const playerImg = new Image();
        playerImg.src = 'player.png';
        const ballImg = new Image();
        ballImg.src = 'ball.png';

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            checkOrientation();
        }

        // iPhoneå¯¾å¿œï¼šå‘ããƒã‚§ãƒƒã‚¯
        function checkOrientation() {
            if (window.innerHeight > window.innerWidth) {
                orientMsg.style.display = "flex";
                gameActive = false;
            } else {
                orientMsg.style.display = "none";
                if (!gameStarted) startScreen.style.display = "flex";
            }
        }

        window.addEventListener('resize', resize);
        window.addEventListener('orientationchange', resize);
        resize();

        let score = 0;
        let gameActive = false;
        let gameStarted = false;
        let gameSpeed = 0;

        const player = {
            x: 80, y: 0, width: 100, height: 100, // ãƒã‚¹ã‚³ãƒƒãƒˆã‚’å¤§ãã
            dy: 0, jumpForce: 18, gravity: 0.8, grounded: false
        };

        let obstacles = [];

        function startGame() {
            gameStarted = true;
            gameActive = true;
            startScreen.style.display = "none";
            score = 0;
            obstacles = [];
            gameSpeed = canvas.width / 110;
            player.y = canvas.height - player.height - 50;
            document.getElementById("scoreDisplay").innerText = "Score: 0";
            spawnObstacle();
            update();
        }

        function spawnObstacle() {
            if (!gameActive) return;
            const size = 60 + Math.random() * 30; // é£›ã³è¶Šãˆã‚„ã™ã„ã‚µã‚¤ã‚º
            obstacles.push({
                x: canvas.width, y: canvas.height - size - 50,
                width: size, height: size
            });
            setTimeout(spawnObstacle, Math.random() * 1500 + 1200);
        }

        function jump() {
            if (orientMsg.style.display === "flex") return; // è­¦å‘Šä¸­ã¯ç„¡åŠ¹

            if (!gameStarted) {
                startGame();
                return;
            }
            if (!gameActive) {
                location.reload();
                return;
            }
            if (player.grounded) {
                player.dy = -player.jumpForce;
                player.grounded = false;
            }
        }

        window.addEventListener("touchstart", (e) => { e.preventDefault(); jump(); }, {passive: false});
        window.addEventListener("mousedown", jump);

        function update() {
            if (!gameActive) return;

            player.dy += player.gravity;
            player.y += player.dy;

            const groundY = canvas.height - player.height - 50;
            if (player.y > groundY) {
                player.y = groundY;
                player.dy = 0;
                player.grounded = true;
            }

            obstacles.forEach((obs, index) => {
                obs.x -= gameSpeed;
                // å½“ãŸã‚Šåˆ¤å®šã‚’å°‘ã—ç”˜ãï¼ˆç”»åƒã®ä½™ç™½å¯¾ç­–ï¼‰
                if (player.x + 20 < obs.x + obs.width - 20 &&
                    player.x + player.width - 20 > obs.x + 20 &&
                    player.y + 20 < obs.y + obs.height - 20 &&
                    player.y + player.height > obs.y + 20) {
                    gameOver();
                }
                if (obs.x + obs.width < 0) {
                    obstacles.splice(index, 1);
                    score++;
                    document.getElementById("scoreDisplay").innerText = "Score: " + score;
                    gameSpeed += 0.05;
                }
            });

            draw();
            requestAnimationFrame(update);
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // åœ°é¢ï¼ˆé€æ˜ã«ã—ã¦èƒŒæ™¯ã®èŠç”Ÿã‚’è¦‹ã›ã‚‹ã‹ã€è–„ãè‰²ã‚’å¡—ã‚‹ï¼‰
            ctx.fillStyle = "rgba(0,0,0,0.1)";
            ctx.fillRect(0, canvas.height - 50, canvas.width, 50);

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆç”»åƒã‚’æç”»ï¼‰
            ctx.drawImage(playerImg, player.x, player.y, player.width, player.height);

            // éšœå®³ç‰©ï¼ˆç”»åƒã‚’æç”»ï¼‰
            obstacles.forEach(obs => {
                ctx.drawImage(ballImg, obs.x, obs.y, obs.width, obs.height);
            });
        }

        function gameOver() {
            gameActive = false;
            ctx.fillStyle = "rgba(0,0,0,0.7)";
            ctx.fillRect(0,0,canvas.width, canvas.height);
            ctx.fillStyle = "white";
            ctx.textAlign = "center";
            ctx.font = "bold 50px sans-serif";
            ctx.fillText("GAME OVER", canvas.width/2, canvas.height/2 - 20);
            ctx.font = "30px sans-serif";
            ctx.fillText("Score: " + score, canvas.width/2, canvas.height/2 + 40);
            ctx.fillText("ã‚¿ãƒƒãƒ—ã—ã¦ã‚‚ã†ä¸€åº¦", canvas.width/2, canvas.height/2 + 100);
        }

        // ç”»åƒèª­ã¿è¾¼ã¿å¾Œã«æœ€åˆã®æç”»
        playerImg.onload = draw;
    </script>
</body>
</html>
