<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é™å²¡ãƒ–ãƒ«ãƒ¼ãƒ¬ãƒ´ã‚ºãƒŸãƒ‹ã‚²ãƒ¼ãƒ </title>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background: #87CEEB; font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif; }
        
        /* èƒŒæ™¯ç”»åƒã®è¨­å®š */
        canvas { 
            display: block; width: 100vw; height: 100vh; touch-action: manipulation;
            background-image: url('bg.jpg');
            background-size: cover;
            background-position: center;
        }

        #scoreDisplay {
            position: absolute; top: 15px; left: 20px;
            font-size: 45px; font-weight: bold; color: #fff; 
            text-shadow: 3px 3px 6px rgba(0,0,0,0.6);
            z-index: 10;
        }

        /* è­¦å‘Šãƒ»ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ã®å…±é€šè¨­å®š */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); color: white;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center; text-align: center; z-index: 10000;
        }

        /* ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ */
        #start-screen h1 { font-size: clamp(30px, 10vw, 60px); margin-bottom: 20px; color: #fff; text-shadow: 0 0 15px #0054a6; }
        #start-screen p { font-size: clamp(20px, 6vw, 30px); animation: blink 1.5s infinite; }

        /* æ¨ªå‘ãè­¦å‘Š */
        #orientation-msg { display: none; }
        #orientation-msg span { font-size: 60px; margin-bottom: 20px; }

        @keyframes blink { 0% {opacity: 1;} 50% {opacity: 0.3;} 100% {opacity: 1;} }
    </style>
</head>
<body>
    <div id="orientation-msg" class="overlay">
        <span>ğŸ“±</span>ç”»é¢ã‚’ã€æ¨ªå‘ãã€‘ã«ã™ã‚‹ã¨<br>ã‚²ãƒ¼ãƒ ãŒã¯ã˜ã¾ã‚‹ã‚ˆï¼
    </div>

    <div id="start-screen" class="overlay">
        <h1>èµ°ã‚Œï¼ãƒ¬ãƒ´ã‚ºãã‚“</h1>
        <p>ç”»é¢ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã‚¹ã‚¿ãƒ¼ãƒˆï¼</p>
    </div>

    <div id="scoreDisplay">Score: 0</div>
    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const startScreen = document.getElementById("start-screen");
        const orientMsg = document.getElementById("orientation-msg");

        // ç”»åƒã®èª­ã¿è¾¼ã¿
        const playerImg = new Image(); playerImg.src = 'player.png';
        const ballImg = new Image(); ballImg.src = 'ball.png';

        let score = 0;
        let gameActive = false;
        let gameStarted = false;
        let isPortrait = false;
        let gameSpeed = 0;
        let animationId;

        const player = { x: 80, y: 0, width: 110, height: 110, dy: 0, jumpForce: 19, gravity: 0.8, grounded: false };
        let obstacles = [];

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            isPortrait = window.innerHeight > window.innerWidth;
            
            if (isPortrait) {
                orientMsg.style.display = "flex";
                startScreen.style.display = "none";
            } else {
                orientMsg.style.display = "none";
                if (!gameStarted) startScreen.style.display = "flex";
            }
            draw();
        }

        window.addEventListener('resize', resize);
        window.addEventListener('orientationchange', resize);
        resize();

        function startGame() {
            if (isPortrait) return;
            gameStarted = true;
            gameActive = true;
            startScreen.style.display = "none";
            score = 0;
            obstacles = [];
            gameSpeed = canvas.width / 100;
            player.y = canvas.height - player.height - 60;
            document.getElementById("scoreDisplay").innerText = "Score: 0";
            
            spawnObstacle();
            update();
        }

        function spawnObstacle() {
            if (!gameActive) return;
            const size = 70 + Math.random() * 30;
            obstacles.push({ x: canvas.width, y: canvas.height - size - 60, width: size, height: size });
            setTimeout(spawnObstacle, Math.random() * 1500 + 1000);
        }

        function jump(e) {
            if (e) {
                e.preventDefault();
                e.stopPropagation();
            }
            if (isPortrait) return;

            // ã‚¹ã‚¿ãƒ¼ãƒˆåˆ¤å®š
            if (!gameStarted) {
                startGame();
                return;
            }
            // ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼åˆ¤å®š
            if (!gameActive) {
                location.reload();
                return;
            }
            // ã‚¸ãƒ£ãƒ³ãƒ—åˆ¤å®š
            if (player.grounded) {
                player.dy = -player.jumpForce;
                player.grounded = false;
            }
        }

        // ã‚¿ãƒƒãƒã¨ã‚¯ãƒªãƒƒã‚¯ä¸¡æ–¹ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç¢ºå®Ÿã«æ‹¾ã†
        canvas.addEventListener("touchstart", jump, {passive: false});
        startScreen.addEventListener("touchstart", jump, {passive: false});
        window.addEventListener("mousedown", (e) => {
            // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹é–“ã‚‚ã‚¯ãƒªãƒƒã‚¯ã‚’æœ‰åŠ¹ã«ã™ã‚‹
            if (e.button === 0) jump(e);
        });

        function update() {
            if (!gameActive) return;

            player.dy += player.gravity;
            player.y += player.dy;

            const groundY = canvas.height - player.height - 60;
            if (player.y > groundY) {
                player.y = groundY;
                player.dy = 0;
                player.grounded = true;
            }

            obstacles.forEach((obs, index) => {
                obs.x -= gameSpeed;
                // å½“ãŸã‚Šåˆ¤å®šã‚’ã•ã‚‰ã«èª¿æ•´ï¼ˆã‚­ãƒ£ãƒ©ã®ä¸­å¿ƒéƒ¨ã®ã¿ã§åˆ¤å®šï¼‰
                if (player.x + 35 < obs.x + obs.width - 35 &&
                    player.x + player.width - 35 > obs.x + 35 &&
                    player.y + 35 < obs.y + obs.height - 35 &&
                    player.y + player.height > obs.y + 35) {
                    gameOver();
                }
                if (obs.x + obs.width < 0) {
                    obstacles.splice(index, 1);
                    score++;
                    document.getElementById("scoreDisplay").innerText = "Score: " + score;
                    gameSpeed += 0.05;
                }
            });

            draw();
            animationId = requestAnimationFrame(update);
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼
            try {
                ctx.drawImage(playerImg, player.x, player.y, player.width, player.height);
            } catch(e) {
                ctx.fillStyle = "#0054a6"; ctx.fillRect(player.x, player.y, player.width, player.height);
            }

            // éšœå®³ç‰©
            obstacles.forEach(obs => {
                try {
                    ctx.drawImage(ballImg, obs.x, obs.y, obs.width, obs.height);
                } catch(e) {
                    ctx.fillStyle = "#e60012"; ctx.fillRect(obs.x, obs.y, obs.width, obs.height);
                }
            });
        }

        function gameOver() {
            gameActive = false;
            cancelAnimationFrame(animationId);
            ctx.fillStyle = "rgba(0,0,0,0.7)";
            ctx.fillRect(0,0,canvas.width, canvas.height);
            ctx.fillStyle = "white";
            ctx.textAlign = "center";
            ctx.font = "bold 45px sans-serif";
            ctx.fillText("è©¦åˆçµ‚äº†ï¼", canvas.width/2, canvas.height/2 - 20);
            ctx.font = "30px sans-serif";
            ctx.fillText("
