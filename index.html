<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ãƒãƒ¼ãƒ å…¬å¼ãƒŸãƒ‹ã‚²ãƒ¼ãƒ </title>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background: #87CEEB; /* ç©ºã®è‰² */ font-family: sans-serif; }
        
        background-image: url('bg.jpg');
        canvas { 
            display: block; width: 100vw; height: 100vh; touch-action: manipulation;
            background-color: transparent; /* èƒŒæ™¯ã‚’é€éã•ã›ã¦ä¸‹ã®bodyã®è‰²ã‚„ç”»åƒã‚’è¦‹ã›ã‚‹ */
             /* background-image: url('ã“ã“ã«ç”»åƒã®ãƒ•ã‚¡ã‚¤ãƒ«å.jpg'); */ /* â†ç”»åƒã‚’ä½¿ã†å ´åˆã¯ã“ã“ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’å¤–ã™ */
            background-size: cover;
            background-position: center;
        }
        /* â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–² */

        #scoreDisplay {
            position: absolute; top: 10px; left: 20px;
            font-size: 30px; font-weight: bold; color: #333; z-index: 10;
        }

        /* å…±é€šã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ãƒ»å›è»¢è­¦å‘Šãªã©ï¼‰ */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); color: white;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center; text-align: center; z-index: 100;
        }

        /* ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ */
        #start-screen { display: flex; cursor: pointer;}
        #start-screen h1 { font-size: 40px; margin-bottom: 20px; color: #E60012; /* ãƒãƒ¼ãƒ ã‚«ãƒ©ãƒ¼ */ }
        #start-screen p { font-size: 24px; animation: blink 1.5s infinite; }

        /* æ¨ªå‘ãæ¨å¥¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆç¸¦ã®æ™‚ã ã‘è¡¨ç¤ºï¼‰ */
        @media screen and (orientation: portrait) {
            #orientation-msg { display: flex !important; }
            #start-screen { display: none !important; } /* ç¸¦å‘ãã®æ™‚ã¯ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ã‚’éš ã™ */
        }
        #orientation-msg { display: none; }

        /* ç‚¹æ»…ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes blink { 0% {opacity: 1;} 50% {opacity: 0.3;} 100% {opacity: 1;} }
    </style>
</head>
<body>
    <div id="orientation-msg" class="overlay">
        ğŸ“±<br>ç”»é¢ã‚’ã€æ¨ªå‘ãã€‘ã«ã—ã¦<br>éŠã‚“ã§ãã ã•ã„ï¼
    </div>

    <div id="start-screen" class="overlay">
        <h1>BLUE REVS RUN!</h1> <p>TAP TO START</p>
    </div>

    <div id="scoreDisplay">Score: 0</div>
    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const startScreen = document.getElementById("start-screen");

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        let score = 0;
        let gameActive = false; // æœ€åˆã¯å‹•ã‹ãªã„ã‚ˆã†ã«ã™ã‚‹
        let gameSpeed = canvas.width / 120; // å°‘ã—ã‚†ã£ãã‚Šã«èª¿æ•´

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆèµ¤ã®å››è§’ï¼‰
        const player = {
            x: 50, y: 0, 
            width: 80, height: 80,
            color: "#E60012",
            dy: 0, jumpForce: 17, gravity: 0.8, grounded: false // ã‚¸ãƒ£ãƒ³ãƒ—åŠ›ã‚’å°‘ã—ã‚¢ãƒƒãƒ—
        };

        let obstacles = [];

        // ã‚²ãƒ¼ãƒ é–‹å§‹å‡¦ç†
        function startGame() {
            if (gameActive) return;
            startScreen.style.display = "none"; // ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ã‚’æ¶ˆã™
            gameActive = true;
            score = 0;
            obstacles = [];
            gameSpeed = canvas.width / 120;
            player.y = canvas.height - player.height - 50; // åœ°é¢ã®ä½ç½®ã«ãƒªã‚»ãƒƒãƒˆ
            document.getElementById("scoreDisplay").innerText = "Score: 0";
            spawnObstacle();
            update();
        }

        // ã€ä¿®æ­£ç‚¹ã€‘éšœå®³ç‰©ã®ç”Ÿæˆ
        function spawnObstacle() {
            if (!gameActive) return;
            // ã‚µã‚¤ã‚ºã‚’å°ã•ãèª¿æ•´ï¼ˆ40ã€œ80ã®é–“ï¼‰
            const size = 40 + Math.random() * 40; 
            obstacles.push({
                x: canvas.width, 
                y: canvas.height - size - 50, // åœ°é¢ã®é«˜ã•ã«åˆã‚ã›ã¦èª¿æ•´
                width: size, height: size, color: "#555"
            });
            // æ¬¡ã®å‡ºç¾æ™‚é–“ã‚’èª¿æ•´
            setTimeout(spawnObstacle, Math.random() * 1500 + 1000);
        }

        function jump() {
            // ã‚²ãƒ¼ãƒ é–‹å§‹å‰ãªã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆã•ã›ã‚‹
            if (!gameActive && startScreen.style.display !== "none") {
                startGame();
                return;
            }
            // ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼å¾Œãªã‚‰ãƒªãƒ­ãƒ¼ãƒ‰
            if (!gameActive && startScreen.style.display === "none") {
                location.reload();
                return;
            }
            // ã‚¸ãƒ£ãƒ³ãƒ—å‡¦ç†
            if (player.grounded && gameActive) {
                player.dy = -player.jumpForce;
                player.grounded = false;
            }
        }

        window.addEventListener("touchstart", (e) => { e.preventDefault(); jump(); }, {passive: false});
        window.addEventListener("mousedown", jump);
        window.addEventListener("keydown", (e) => { if(e.code==="Space") jump(); });

        function update() {
            if (!gameActive) return;

            player.dy += player.gravity;
            player.y += player.dy;

            // åœ°é¢ã®åˆ¤å®šï¼ˆèŠç”Ÿã‚¨ãƒªã‚¢ã‚’æƒ³å®šã—ã¦å°‘ã—é«˜ãè¨­å®šï¼‰
            const groundY = canvas.height - player.height - 50; 
            if (player.y > groundY) {
                player.y = groundY;
                player.dy = 0;
                player.grounded = true;
            }

            obstacles.forEach((obs, index) => {
                obs.x -= gameSpeed;
                // å½“ãŸã‚Šåˆ¤å®šï¼ˆå°‘ã—ç”˜ã‚ã«èª¿æ•´ï¼šå››è§’å½¢ã®ä¸Šä¸‹å·¦å³ã‚’æ•°ãƒ”ã‚¯ã‚»ãƒ«å†…å´ã§åˆ¤å®šï¼‰
                 if (player.x + 10 < obs.x + obs.width - 5 &&
                    player.x + player.width - 10 > obs.x + 5 &&
                    player.y + 10 < obs.y + obs.height - 5 &&
                    player.y + player.height > obs.y + 5) {
                    gameOver();
                }
                if (obs.x + obs.width < 0) {
                    obstacles.splice(index, 1);
                    score++;
                    document.getElementById("scoreDisplay").innerText = "Score: " + score;
                    gameSpeed += 0.05; // ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—ã‚’ç·©ã‚„ã‹ã«
                }
            });

            draw();
            requestAnimationFrame(update);
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // åœ°é¢ï¼ˆèŠç”Ÿï¼‰ã‚’æãï¼ˆä»®ã®ç·‘è‰²ï¼‰
            ctx.fillStyle = "#228B22";
            ctx.fillRect(0, canvas.height - 50, canvas.width, 50);

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x, player.y, player.width, player.height);

            // éšœå®³ç‰©
            ctx.fillStyle = obs.color;
            obstacles.forEach(obs => {
                ctx.fillRect(obs.x, obs.y, obs.width, obs.height);
            });
        }

        function gameOver() {
            gameActive = false;
            ctx.fillStyle = "rgba(0,0,0,0.7)";
            ctx.fillRect(0,0,canvas.width, canvas.height);
            ctx.fillStyle = "white";
            ctx.font = "bold 40px sans-serif";
            ctx.textAlign = "center";
            ctx.fillText("GAME OVER", canvas.width/2, canvas.height/2);
            ctx.font = "20px sans-serif";
            ctx.fillText("Score: " + score, canvas.width/2, canvas.height/2 + 40);
            ctx.font = "20px sans-serif";
            ctx.fillText("ã‚¿ãƒƒãƒ—ã—ã¦å†æŒ‘æˆ¦", canvas.width/2, canvas.height/2 + 80);
        }

        // æœ€åˆã®æç”»ã ã‘ã—ã¦ãŠã
        draw();
    </script>
</body>
</html>
